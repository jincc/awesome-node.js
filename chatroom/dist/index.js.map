{"version":3,"sources":["../libs/index.js"],"names":["http","require","path","fs","mime","chatServer","CACHES","send404","response","writeHead","write","end","sendFile","filePath","fileContents","mimeType","getType","basename","serveStatic","cache","absPath","exists","exist","readFile","err","contents","server","createServer","request","url","join","__dirname","listen","console","log"],"mappings":";;AAAA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;AACA,IAAIC,OAAOD,QAAQ,MAAR,CAAX;AACA,IAAIE,KAAKF,QAAQ,IAAR,CAAT;AACA,IAAIG,OAAOH,QAAQ,MAAR,CAAX;AACA;AACA,IAAII,aAAaJ,QAAQ,eAAR,CAAjB;;AAEA,IAAIK,SAAS,EAAb;AACA,SAASC,OAAT,CAAiBC,QAAjB,EAA0B;AACtBA,aAASC,SAAT,CAAmB,GAAnB,EAAuB,EAAC,gBAAe,YAAhB,EAAvB;AACAD,aAASE,KAAT,CAAe,8BAAf;AACAF,aAASG,GAAT;AACH;;AAED,SAASC,QAAT,CAAkBJ,QAAlB,EAA2BK,QAA3B,EAAoCC,YAApC,EAAiD;AAC7C,QAAMC,WAAWX,KAAKY,OAAL,CAAad,KAAKe,QAAL,CAAcJ,QAAd,CAAb,CAAjB;AACAL,aAASC,SAAT,CAAmB,GAAnB,EAAuB,EAAC,gBAAeM,QAAhB,EAAvB;AACAP,aAASG,GAAT,CAAaG,YAAb;AACH;AACD;AACA,SAASI,WAAT,CAAqBV,QAArB,EAA8BW,KAA9B,EAAoCC,OAApC,EAA4C;AACxC,QAAID,MAAMC,OAAN,CAAJ,EAAmB;AACfR,iBAASJ,QAAT,EAAkBY,OAAlB,EAA0BD,MAAMC,OAAN,CAA1B;AACH,KAFD,MAEK;AACDjB,WAAGkB,MAAH,CAAUD,OAAV,EAAkB,UAACE,KAAD,EAAW;AACzB,gBAAIA,KAAJ,EAAU;AACN;AACAnB,mBAAGoB,QAAH,CAAYH,OAAZ,EAAoB,UAACI,GAAD,EAAKC,QAAL,EAAgB;AAChC,wBAAGD,GAAH,EAAO;AACHjB,gCAAQC,QAAR;AACH,qBAFD,MAEK;AACDW,8BAAMC,OAAN,IAAiBK,QAAjB;AACAb,iCAASJ,QAAT,EAAkBY,OAAlB,EAA0BD,MAAMC,OAAN,CAA1B;AACH;AACJ,iBAPD;AAQH,aAVD,MAUK;AACDb,wBAAQC,QAAR;AACH;AACJ,SAdD;AAeH;AACJ;;AAED,IAAIkB,SAAS1B,KAAK2B,YAAL,CAAkB,UAACC,OAAD,EAASpB,QAAT,EAAoB;AAC/C,QAAIK,WAAW,IAAf;AACA,QAAIe,QAAQC,GAAR,IAAe,GAAnB,EAAuB;AACnBhB,mBAAW,sBAAX;AACH,KAFD,MAEK;AACDA,mBAAW,cAAce,QAAQC,GAAjC;AACH;AACDX,gBAAYV,QAAZ,EAAqBF,MAArB,EAA4BJ,KAAK4B,IAAL,CAAUC,SAAV,EAAoBlB,QAApB,CAA5B;AACH,CARY,CAAb;AASA;AACAR,WAAW2B,MAAX,CAAkBN,MAAlB;;AAEAA,OAAOM,MAAP,CAAc,IAAd,EAAmB,YAAI;AACnBC,YAAQC,GAAR,CAAY,0BAAZ;AACH,CAFD","file":"index.js","sourcesContent":["var http = require('http')\nvar path = require('path')\nvar fs = require('fs')\nvar mime = require('mime')\n//处理基于socket。io服务端聊天功能的模块\nvar chatServer = require('./chat_server')\n\nvar CACHES = {}\nfunction send404(response){\n    response.writeHead(404,{'Content-Type':'text/plain'})\n    response.write('Error 404:resource not found')\n    response.end()\n}\n\nfunction sendFile(response,filePath,fileContents){\n    const mimeType = mime.getType(path.basename(filePath))\n    response.writeHead(200,{'Content-Type':mimeType})\n    response.end(fileContents)\n}\n//冲缓存里获取文件\nfunction serveStatic(response,cache,absPath){\n    if (cache[absPath]){\n        sendFile(response,absPath,cache[absPath])\n    }else{\n        fs.exists(absPath,(exist) => {\n            if (exist){\n                //读取\n                fs.readFile(absPath,(err,contents)=>{\n                    if(err){\n                        send404(response)\n                    }else{\n                        cache[absPath] = contents\n                        sendFile(response,absPath,cache[absPath])\n                    }\n                })\n            }else{\n                send404(response)\n            }\n        })\n    }\n}\n\nvar server = http.createServer((request,response)=>{\n    var filePath = null\n    if (request.url == '/'){\n        filePath = '../public/index.html'\n    }else{\n        filePath = '../public' + request.url\n    }\n    serveStatic(response,CACHES,path.join(__dirname,filePath))\n})\n//启动socket.io\nchatServer.listen(server)\n\nserver.listen(3000,()=>{\n    console.log('server start listen 3000')\n})\n\n"]}